<script>
var chart1; // globally available
$(document).ready(function() {
    groupChart = new Highcharts.Chart({
       chart: {
          renderTo: 'groupGraph',
          type: 'bar'
       },
       title: {
          text: 'Top 10 Groups'
       },
       xAxis: {
          categories: [
             <% @majorGroups.each do |info| %>
              '<%= info[:name]%>',
             <% end %>
          ]
       },
       yAxis: {
          title: {
             text: 'Lari'
          }
       },
       series: [        
               {
                name: "Awarded Contract Total",
                data: [ <% @majorGroups.each do |info| %> <%= info[:total] %>, <% end %>]
               },  
      ]   
    });

 });
</script>

<%cpvArray = []%>
<% @globalCpvGroups.each do |group| %>
	<% cpvArray.push([group.name, group.id]) %>
<%end%>

<% if @userCpvGroups.count > 0 %>
	<% cpvArray.push(["---User CPV Groups---", 0,{:disabled => true}])%>
	<% @userCpvGroups.each do |group| %>
		<% cpvArray.push([group.name, group.id]) %>
	<%end%>
<%end%>
<% newCPVUrl = url_for(:controller => "cpv_tree", :action => "showCPVTree") %>

<% cpvArray.push(["---Create Custom CPV Group---", -1, {:onclick => "window.location.replace('"+newCPVUrl+"');"}])%>

<div class="tabs tab-div">
  <ul>
    <li><a href="#tabs-1"><%=t("Search Tenders")%></a></li>
    <li><a href="#tabs-2"><%=t("Search Companies")%></a></li>
    <li><a href="#tabs-3"><%=t("Search Procurers")%></a></li>
  </ul>
  <div id="tabs-1" class="expansion top-tab" >
    <%= form_tag({:controller => "tender", :action => "search"}, :method => "get") do %>
      <div class="row-fluid">
        <div class="span5" >
          <label for="supplier" class="search"><%=t("Supplier")%></label>
          <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <%=text_field_tag( 'supplier_name', nil,  :class => "large-textfield", :data => {autocomplete_source: url_for(:controller => "organizations", :action => "getSuppliers") } ) %>
        </div>
        <div class="span5" >
          <label for="procurer" class="search"><%=t("Procurer")%></label>
          <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <%=text_field_tag( 'procurer_name', nil, :class => "large-textfield", :data => {autocomplete_source: url_for(:controller => "organizations", :action => "getProcurers") } ) %>
        </div>
      </div>
      <br>
      <div class="row-fluid">
        <div class="span3">
          <label for="tender_status" class="search"><%=t("Status")%></label>
          <a href="#" class="info-tip">&nbsp;<span>The stage a tender is currently in</span></a>
          <% options = [] %>
          <% @uniqueStatus.each do |status| %>
            <% options.push(item = [t(status),status]) %>
          <% end %>
          <%= select_tag(:tender_status, options_for_select(options), :include_blank => true)  %>
        </div>
        <div class="span3">        
          <label for="cpvGroup" class="search"><%= t("Category")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <%= select_tag(:cpvGroup, options_for_select(cpvArray)) %>
        </div>
        <div class="span3">
          <label for="risk_indicator" class="search"><%=t("Risk Indicator")%> </label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <%= select_tag(:risk_indicator,  options_from_collection_for_select(@indicators,:id,:name),{:include_blank => true})  %>
        </div>
        <div class="span3">
          <label for="type" class="search"><%=t("Type")%> </label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <% options = [] %>
          <% @uniqueTypes.each do |type| %>
            <% options.push(item = [t(type.strip()),type]) %>
          <% end %>
          <%= select_tag(:type,  options_for_select(options),{:include_blank => true})  %>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span3 offset9">
          <div class="arrow-label expandToggle">Additional Search</div>
          <div class="arrow expandToggle"></div> 
          <%= submit_tag( t('Search'), :class => "submit-button") %>
        </div>
      </div>
      
      <div class="row-fluid expandable">    
        <hr>      
        <div class="span3 offset1">
          <label for="min_estimate" class="search"><%=t("Minimum Cost Estimate")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="min_estimate" type="text"/>
          <label for="max_estimate" class="search"><%=t("Maximum Cost Estimate")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="max_estimate" type="text"/>

          <label for="min_num_bids" class="search"><%=t("Min Number Of Bids")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="min_num_bids" type="text"/>
          <label for="max_num_bids" class="search"><%=t("Max Number Of Bids")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="max_num_bids" type="text"/>

          <label for="min_num_bidders" class="search"><%=t("Min Number Of Bidders")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="min_num_bidders" type="text"/>
          <label for="max_num_bidders" class="search"><%=t("Max Number Of Bidders")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="max_num_bidders" type="text"/>
        </div>
        <div class="span3" >
          <label for="tender_registration_number" class="search"><%=t("Registration Code")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="tender_registration_number" type="text"/>
          <label for="announced_after" class="search"><%=t("Announced After")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="announced_after" type="text" class="dp2" value="" data-date-format="yyyy/mm/dd" id="dp2"/>
          <label for="announced_before" class="search"><%=t("Announced Before")%></label>  
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="announced_before" type="text" class="dp2" value="" data-date-format="yyyy/mm/dd" id="dp3"/>
        </div>
        <div class="span3">
          <label for="keyword" class="search"><%=t("Keyword")%></label>
          <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="keyword" class="search-input" type="text"/>
        </div>
      </div>
    <% end %>
  </div>
  <div id="tabs-2" class="expansion top-tab">
    <%= form_tag({:controller => "organization", :action => "search"}, :method => "get") do %>
    <div class="row-fluid">
      <div class="span4">    
        <label for="name" class="search"><%=t("Name")%></label>
        <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
        <%=text_field_tag( 'supplier_search_name', nil, :data => {autocomplete_source: url_for(:controller => "organizations", :action => "getSuppliers") } ) %>
      </div>
      <div class="span4">
        <label for="code" class="search"><%=t("Code")%></label>
       <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
        <input name="code" type="text"/>
      </div>
      <div class="span4">
        <label for="org_type" class="search"><%=t("Type")%></label>
       <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
        <% types = [] %>
        <% @orgTypes.each do |orgType| %>
          <% types.push(item = [t(orgType),orgType]) %>
        <%end%>
        <%= select_tag(:org_type, options_for_select(types), :include_blank => true)  %>
      </div>

      <div class="span3 offset9">
        <div class="arrow-label expandToggle">Additional Search</div>
        <div class="arrow expandToggle"></div> 
        <%= submit_tag( t('Search'), :class => "submit-button") %>
      </div>
    </div>
 
    <div class="row-fluid expandable">
      <div class="row-fluid">
        <hr>
      </div>
      <div class="row-fluid">
        <div class="span3">
          <label for="email" class="search"><%=t("Email")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="email" type="text"/>
        </div>
        <div class="span3">
          <label for="address" class="search"><%=t("Address")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="address" type="text"/>
        </div>
        <div class="span3">
          <label for="city" class="search"><%=t("City")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="city" type="text"/>
        </div>
        <div class="span3">
          <label for="phone_number" class="search"><%=t("Phone Number")%></label>
         <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
          <input name="phone_number" type="text"/>
        </div>
      </div>
      <div class="row-fluid">
        <div class="span3">
          <%= label_tag(:isForeign, "Only Foreign") %>
          <%= check_box_tag(:isForeign) %>
        </div>
        <div class="span3">
          <%= label_tag(:bw_list, "Black or White list") %>
          <%= select_tag(:bw_list, options_for_select([[t("White List"),"W"], [t("Black List"), "B"]]), :include_blank => true )%>
        </div>
      </div>
    </div>
     <% end %>
  </div>
  <div id="tabs-3" class="top-tab">
    <%= form_tag({:controller => "organization", :action => "search_procurer"}, :method => "get") do %>
    <div class="row-fluid">
      <div class="span4">
        <label for="name" class="search"><%=t("Name")%></label>
        <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
        <%=text_field_tag( 'procurer_search_name', nil, :data => {autocomplete_source: url_for(:controller => "organizations", :action => "getProcurers") } ) %>
      </div>
      <div class="span4">
        <label for="code" class="search"><%=t("Code")%></label>
       <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
        <input name="code" type="text"/>
      </div>
      <div class="span4">
        <label for="org_type" class="search"><%=t("Type")%></label>
       <a href="#" class="info-tip">&nbsp;<span>Placeholder text</span></a>
        <% types = [] %>
        <% @procTypes.each do |orgType| %>
          <% orgType = orgType.gsub(".","") %>
          <% types.push(item = [t(orgType),orgType]) %>
        <% end %>
        <%= select_tag(:org_type, options_for_select(types), :include_blank => true )%>    
      </div>
    </div>

    <div class="row-fluid">
      <div class="span2 offset10">
        <%= submit_tag( t('Search'), :class => "submit-button") %>
      </div>
    </div>
    <% end %>
  </div>
</div>

<div class="tabs ui-tabs tab-div">
  <ul>
    <li class="tab-header"><a href="#tabs-1"><%=t("Top CPV Groups")%></a></li>
    <li class="tab-header"><a href="#tabs-2"><%=t("Top Suppliers")%></a></li>
    <li class="tab-header"><a href="#tabs-3"><%=t("Top Procurers")%></a></li>
  </ul>

  <div id="tabs-1" class="tab-inner">
    <div class="row-fluid">
      <div id="groupGraph"></div>   
    </div>
  </div>

  <div id="tabs-2" class="tab-inner">
    <div class="row-fluid">
      <div class="span8 offset4">
        <h4><%=t("Sector")%></<h4><br>
        <%= select_tag(:cpvGroup, options_for_select(cpvArray), 
          :data => { :remote => true, 
                     :url => url_for(:controller => "root", 
                     :action => "cpvVsCompany") } )  %>     
      </div>
    </div>
    <div class="row-fluid">
      <div id="graph"></div>   
    </div>
  </div>
  <div id="tabs-3" class="tab-inner">
      <div class="row-fluid">
        <div class="span8 offset4">
          <h4><%=t("Sector")%></<h4><br>
          <%= select_tag(:cpvGroup, options_for_select(cpvArray),
            :data => { :remote => true, 
                       :url => url_for(:controller => "root", 
                       :action => "cpvVsProcurer") } )  %>     
        </div>
      </div>

    <div class="row-fluid">
      <div id="procGraph"></div>   
    </div>
  </div>

</div>



